import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.Base64;
import org.apache.http.HttpEntity;
import org.apache.http.HttpHeaders;
import org.apache.http.HttpResponse;
import org.apache.http.client.HttpClient;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.entity.ContentType;
import org.apache.http.entity.StringEntity;
import org.apache.http.impl.client.HttpClients;

public class SharePointRESTConnector {
    public static void main(String[] args) {
        String siteUrl = "https://your-sharepoint-site";
        String username = "your_username";
        String password = "your_password";
        String documentLibrary = "Shared Documents"; // Replace with the desired document library name
        String filePath = "path/to/your/csvfile.csv";

        try {
            // Read file content and encode it to Base64
            Path file = Paths.get(filePath);
            byte[] fileContent = Files.readAllBytes(file);
            String encodedContent = Base64.getEncoder().encodeToString(fileContent);

            // Prepare REST API URL and request
            String restApiUrl = siteUrl + "/_api/web/GetFolderByServerRelativeUrl('" + documentLibrary + "')/Files/Add(url='" + file.getFileName().toString() + "',overwrite=true)";
            HttpClient httpClient = HttpClients.createDefault();
            HttpPost httpPost = new HttpPost(restApiUrl);
            httpPost.setHeader(HttpHeaders.CONTENT_TYPE, "application/json;odata=verbose");
            httpPost.setHeader(HttpHeaders.AUTHORIZATION, "Basic " + getEncodedCredentials(username, password));

            // Set the file content as the request body
            StringEntity requestEntity = new StringEntity("{'__metadata':{'type':'SP.File'},'Content': '" + encodedContent + "'}", ContentType.APPLICATION_JSON);
            httpPost.setEntity(requestEntity);

            // Send the request
            HttpResponse response = httpClient.execute(httpPost);

            // Check the response status
            int statusCode = response.getStatusLine().getStatusCode();
            if (statusCode == 200 || statusCode == 201) {
                System.out.println("File uploaded successfully to SharePoint.");
            } else {
                System.out.println("Failed to upload file to SharePoint. Status code: " + statusCode);
            }

        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    private static String getEncodedCredentials(String username, String password) {
        String credentials = username + ":" + password;
        return Base64.getEncoder().encodeToString(credentials.getBytes());
    }
}
